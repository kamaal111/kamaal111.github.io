(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[845],{5479:function(s,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/content/til/npmPublish",function(){return e(6018)}])},6018:function(s,n,e){"use strict";e.r(n);var a=e(5893),l=e(1151),c=e(3882),i=e(7312);function _createMdxContent(s){let n=Object.assign({h2:"h2",ul:"ul",li:"li",a:"a",h3:"h3",ol:"ol",p:"p",pre:"pre",code:"code",span:"span",em:"em"},(0,l.ah)(),s.components);return(0,a.jsxs)(c.Z,{title:"Publishing an TypeScript package the complete guide",children:[(0,a.jsx)(n.h2,{children:"Pre requisites"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Node.js ",(0,a.jsx)(n.a,{href:"https://nodejs.org/en",children:"install from here"})]}),"\n",(0,a.jsxs)(n.li,{children:["Have an NPM account ",(0,a.jsx)(n.a,{href:"https://www.npmjs.com/signup",children:"click here to sign up"})]}),"\n"]}),(0,a.jsx)(n.h3,{children:"Optionally if you want to publish from Github Actions"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Have an Github account ",(0,a.jsx)(n.a,{href:"https://github.com/signup",children:"click here to sign up"})]}),"\n"]}),(0,a.jsx)(n.h2,{children:"Steps to publish"}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Login to NPM"}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"hljs language-bash",children:"npm login\n"})})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"In an empty directory initailize npm package."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"hljs language-bash",children:"npm init -y\n"})})}),"\n",(0,a.jsxs)(n.p,{children:["To be able to publish the compiled types and compiled JavaScript files we need to make certain changes to the ",(0,a.jsx)(n.code,{children:"package.json"})," file:"]}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-json",children:[(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"{"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"name"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:'"<FILL WITH THE PACKAGE NAME>"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"version"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:'"<FILL IN WITH THE INITIAL VERSION>"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"main"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:'"index.js"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"typings"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:'"index.d.ts"'}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// ... All the rest"}),"\n",(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"}"}),"\n"]})})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Install TypeScript."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"hljs language-bash",children:"npm install -D typescript\n"})})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Initailize TypeScript config."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"hljs language-bash",children:"npx tsc --init\n"})})}),"\n",(0,a.jsx)(n.p,{children:"The most simple TypeScript configuration needed to distribute an TypeScript NPM package goes as the following:"}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-json",children:[(0,a.jsx)(n.span,{className:"hljs-comment",children:"// tsconfig.json"}),"\n",(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"{"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// Only compile files in the src directory"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"include"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"["}),(0,a.jsx)(n.span,{className:"hljs-string",children:'"src"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"]"}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"compilerOptions"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"{"}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// Compile to es2016"}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"target"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:'"es2016"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// Compile to commonjs"}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"module"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:'"commonjs"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// Compile to type definitions"}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"declaration"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-literal",children:(0,a.jsx)(n.span,{className:"hljs-keyword",children:"true"})}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// Compile to type definition maps"}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"declarationMap"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-literal",children:(0,a.jsx)(n.span,{className:"hljs-keyword",children:"true"})}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// Compile to source maps"}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"sourceMap"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-literal",children:(0,a.jsx)(n.span,{className:"hljs-keyword",children:"true"})}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// The directory to compile to"}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"outDir"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:'"dist"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// Compile additional JavaScript to ease support for importing CommonJS modules."}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"esModuleInterop"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-literal",children:(0,a.jsx)(n.span,{className:"hljs-keyword",children:"true"})}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"}"}),"\n",(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"}"}),"\n"]})})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create the main package file."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-bash",children:[(0,a.jsx)(n.span,{className:"hljs-built_in",children:"mkdir"})," src && ",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"touch"})," src/index.ts\n"]})})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Export anything from your main TypeScript file (",(0,a.jsx)(n.code,{children:"src/index.ts"}),"). For the sake of simplicity we will export an simple sum function."]}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-typescript",children:[(0,a.jsx)(n.span,{className:"hljs-comment",children:"// src/index.ts"}),"\n\n",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"sum"}),"(",(0,a.jsxs)(n.span,{className:"hljs-params",children:["a: ",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"number"}),", b: ",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"number"})]}),"): ",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"number"})," {\n    ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"return"})," a + b;\n}\n"]})})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Compile your TypeScript to JavaScript."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"hljs language-bash",children:"npx tsc\n"})})}),"\n",(0,a.jsxs)(n.p,{children:["Now you should have the compiled files in the ",(0,a.jsx)(n.code,{children:"dist"})," directory."]}),"\n",(0,a.jsxs)(n.p,{children:["To have a clean module structure for your NPM package, we will need to copy the ",(0,a.jsx)(n.code,{children:"package.json"})," file over to the ",(0,a.jsx)(n.code,{children:"dist"})," directory."]}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-bash",children:[(0,a.jsx)(n.span,{className:"hljs-built_in",children:"cp"})," package.json dist/package.json\n"]})})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.em,{children:["Tip: to not forget how to to build your package, you can add the above commands in your ",(0,a.jsx)(n.code,{children:"package.json"})," scripts"]})}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-json",children:[(0,a.jsx)(n.span,{className:"hljs-attr",children:'"scripts"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"{"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// ... all the rest"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"build"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:'"tsc && cp package.json dist/package.json"'}),"\n",(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"}"}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n"]})})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Publish the packge to NPM"}),"\n",(0,a.jsx)(n.p,{children:"To simplify publishing and also to make publishing the NPM package easily extensible, we can create a script file to do so."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-bash",children:[(0,a.jsx)(n.span,{className:"hljs-built_in",children:"mkdir"})," -p scripts\n",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"touch"})," scripts/publish.sh\n"]})})}),"\n",(0,a.jsx)(n.p,{children:"The publish script will run all commands needed to be able to publish the NPM package."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-bash",children:[(0,a.jsx)(n.span,{className:"hljs-comment",children:"# scripts/publish.sh"}),"\n\nnpm install ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Install all npm packages in this module"}),"\n",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"rm"})," -rf dist ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Delete the output directory in case it was previously created"}),"\nnpm run build ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Compile the TypeScript files"}),"\n",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"cp"})," package.json dist/package.json ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Copy the package.json as its needed to complete NPM package"}),"\n",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"cd"})," dist ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Enter the output directory"}),"\nnpm publish --access public ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Publish the module"}),"\n"]})})}),"\n",(0,a.jsxs)(n.p,{children:["Add the following command to the scripts property in your ",(0,a.jsx)(n.code,{children:"package.json"})," file."]}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-json",children:[(0,a.jsx)(n.span,{className:"hljs-attr",children:'"scripts"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"{"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"// ... all the rest"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:'"deploy"'}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:":"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:'"sh scripts/publish.sh"'}),"\n",(0,a.jsx)(n.span,{className:"hljs-punctuation",children:"}"}),(0,a.jsx)(n.span,{className:"hljs-punctuation",children:","}),"\n"]})})}),"\n",(0,a.jsx)(n.p,{children:"Now run the above added command."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"hljs language-bash",children:"npm run deploy\n"})})}),"\n",(0,a.jsx)(n.p,{children:"If all went well your package should have been published to NPM \uD83C\uDF89"}),"\n"]}),"\n"]}),(0,a.jsx)(n.h2,{children:"Publish via Github Actions"}),(0,a.jsx)(n.p,{children:"Assuming you followed the above we can start publishing the package via Github Action when a tag has been pushed."}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Add your NPM authentication token to the secrets of your modules repository as ",(0,a.jsx)(n.code,{children:"NPM_TOKEN"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Follow NPMs documentation on how to create a NPM authentication token ",(0,a.jsx)(n.a,{href:"https://docs.npmjs.com/creating-and-viewing-access-tokens",children:"creating-and-viewing-access-tokens"})]}),"\n",(0,a.jsxs)(n.p,{children:["Follow Githubs documentation on how to add secrets to your repository ",(0,a.jsx)(n.a,{href:"https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions#creating-secrets-for-a-repository",children:"creating-secrets-for-a-repository"})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create the Github Actions release workflow file."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-bash",children:[(0,a.jsx)(n.span,{className:"hljs-built_in",children:"mkdir"})," -p .github .github/workflows\n",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"touch"})," .github/workflows/release.yml\n"]})})}),"\n",(0,a.jsx)(n.p,{children:"Contents of the release workflow file."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-yaml",children:[(0,a.jsx)(n.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"Release"}),"\n",(0,a.jsx)(n.span,{className:"hljs-attr",children:"on:"}),"\n",(0,a.jsx)(n.span,{className:"hljs-attr",children:"push:"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"tags:"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-bullet",children:"-"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"'*'"}),"\n",(0,a.jsx)(n.span,{className:"hljs-attr",children:"jobs:"}),"\n",(0,a.jsx)(n.span,{className:"hljs-attr",children:"build:"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"Deploy"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"runs-on:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"ubuntu-latest"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"steps:"}),"\n    ",(0,a.jsx)(n.span,{className:"hljs-bullet",children:"-"})," ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"Checkout"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"repo"}),"\n      ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"uses:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"actions/checkout@v4"}),"\n\n    ",(0,a.jsx)(n.span,{className:"hljs-bullet",children:"-"})," ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"Use"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"Node"}),"\n      ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"uses:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"actions/setup-node@v4"}),"\n      ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"with:"}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"registry-url:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"https://registry.npmjs.org"}),"\n\n    ",(0,a.jsx)(n.span,{className:"hljs-bullet",children:"-"})," ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"Install"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"deps"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"and"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"build"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"(with"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"cache)"}),"\n      ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"uses:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"bahmutov/npm-install@v1"}),"\n\n    ",(0,a.jsx)(n.span,{className:"hljs-bullet",children:"-"})," ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"Publish"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"${{"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"github.ref_name"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"}}"}),"\n      ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"run:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"npm"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"run"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"deploy"}),"\n      ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"env:"}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"VERSION:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"${{"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"github.ref_name"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"}}"}),"\n        ",(0,a.jsx)(n.span,{className:"hljs-attr",children:"NODE_AUTH_TOKEN:"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"${{"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"secrets.NPM_TOKEN"})," ",(0,a.jsx)(n.span,{className:"hljs-string",children:"}}"}),"\n"]})})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Replace the version in ",(0,a.jsx)(n.code,{children:"package.json"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["In the spirit of automating the whole flow, we want to get the version from the tag and replace it in the ",(0,a.jsx)(n.code,{children:"package.json"}),".\nTo do this we will create another script that would do this for us."]}),"\n",(0,a.jsx)(n.p,{children:"Create the script file to replace the version."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-bash",children:[(0,a.jsx)(n.span,{className:"hljs-built_in",children:"touch"})," .scripts/deployment-package-json.js\n"]})})}),"\n",(0,a.jsx)(n.p,{children:"Contents of the replace version script."}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"hljs-comment",children:"// scripts/deployment-package-json.js"}),"\n\n",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"const"})," fs = ",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"require"}),"(",(0,a.jsx)(n.span,{className:"hljs-string",children:"'fs/promises'"}),");\n\n",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"const"})," ",(0,a.jsx)(n.span,{className:"hljs-variable constant_",children:"PACKAGE_JSON_FILENAME"})," = ",(0,a.jsx)(n.span,{className:"hljs-string",children:"'package.json'"}),";\n\n",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"async"})," ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"main"}),"(",(0,a.jsx)(n.span,{className:"hljs-params"}),") {\n    ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"const"})," packageJSON = ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"await"})," ",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"readJSON"}),"(",(0,a.jsx)(n.span,{className:"hljs-variable constant_",children:"PACKAGE_JSON_FILENAME"}),");\n    ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"const"})," modifiedPackageJSON = ",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"modifyPackageJSON"}),"(packageJSON);\n    ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"await"})," fs.",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"writeFile"}),"(\n        ",(0,a.jsxs)(n.span,{className:"hljs-string",children:["`dist/",(0,a.jsx)(n.span,{className:"hljs-subst",children:"${PACKAGE_JSON_FILENAME}"}),"`"]}),",\n        ",(0,a.jsx)(n.span,{className:"hljs-title class_",children:"JSON"}),".",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"stringify"}),"(modifiedPackageJSON, ",(0,a.jsx)(n.span,{className:"hljs-literal",children:"null"}),", ",(0,a.jsx)(n.span,{className:"hljs-number",children:"2"}),")\n    );\n}\n\n",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"modifyPackageJSON"}),"(",(0,a.jsx)(n.span,{className:"hljs-params",children:"packageJSON"}),") {\n    ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"const"})," argumentVersion = process.",(0,a.jsx)(n.span,{className:"hljs-property",children:"argv"}),"[",(0,a.jsx)(n.span,{className:"hljs-number",children:"2"}),"];\n    ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"const"})," version =\n        argumentVersion && argumentVersion !== ",(0,a.jsx)(n.span,{className:"hljs-string",children:"'null'"}),"\n        ? argumentVersion\n        : packageJSON.",(0,a.jsx)(n.span,{className:"hljs-property",children:"version"}),";\n    ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"return"})," { ...packageJSON, version };\n}\n\n",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"async"})," ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"readJSON"}),"(",(0,a.jsx)(n.span,{className:"hljs-params",children:"path"}),") {\n    ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"const"})," buffer = ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"await"})," fs.",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"readFile"}),"(path);\n    ",(0,a.jsx)(n.span,{className:"hljs-keyword",children:"return"})," ",(0,a.jsx)(n.span,{className:"hljs-title class_",children:"JSON"}),".",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"parse"}),"(buffer.",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"toString"}),"());\n}\n\n",(0,a.jsx)(n.span,{className:"hljs-title function_",children:"main"}),"();\n"]})})}),"\n",(0,a.jsxs)(n.p,{children:["The script above will replace the copy ",(0,a.jsx)(n.code,{children:"package.json"})," command we had before to deploy the module in the publish script (",(0,a.jsx)(n.code,{children:"scripts/publish.sh"}),").\nSo the updated publish script (",(0,a.jsx)(n.code,{children:"scripts/publish.sh"}),") would look like the following:"]}),"\n",(0,a.jsx)(i.Z,{children:(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-bash",children:[(0,a.jsx)(n.span,{className:"hljs-comment",children:"# scripts/publish.sh"}),"\n\nnpm install ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Install all npm packages in this module"}),"\n",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"rm"})," -rf dist ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Delete the output directory in case it was previously created"}),"\nnpm run build ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Compile the TypeScript files"}),"\nnode scripts/deployment-package-json.js ",(0,a.jsxs)(n.span,{className:"hljs-string",children:['"',(0,a.jsx)(n.span,{className:"hljs-variable",children:"${VERSION:-null}"}),'"']})," ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Replace package.json version number"}),"\n",(0,a.jsx)(n.span,{className:"hljs-built_in",children:"cd"})," dist ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Enter the output directory"}),"\nnpm publish --access public ",(0,a.jsx)(n.span,{className:"hljs-comment",children:"# Publish the module"}),"\n"]})})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Commit, push and release \uD83D\uDE80\uD83D\uDE80\uD83D\uDE80"}),"\n",(0,a.jsxs)(n.p,{children:["Follow Githubs documentation on how to release your module with a tag ",(0,a.jsx)(n.a,{href:"https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository#creating-a-release",children:"creating-a-release"})]}),"\n"]}),"\n"]})]})}n.default=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,l.ah)(),s.components);return n?(0,a.jsx)(n,Object.assign({},s,{children:(0,a.jsx)(_createMdxContent,s)})):_createMdxContent(s)}},7312:function(s,n,e){"use strict";var a=e(5893);e(7294);var l=e(3967),c=e.n(l),i=e(7518);async function onClick(s){var n,e,a;let l;let c=null===(a=s.props)||void 0===a?void 0:null===(e=a.children)||void 0===e?void 0:null===(n=e.props)||void 0===n?void 0:n.children;null!=c&&(l="string"==typeof c?c:c.map(s=>{var n,e;return"string"==typeof s?s:null!==(e=null==s?void 0:null===(n=s.props)||void 0===n?void 0:n.children)&&void 0!==e?e:""}).join(""),await navigator.clipboard.writeText(l))}n.Z=function(s){let{children:n,enabled:e=!0}=s;return e?(0,a.jsxs)("div",{className:"copyable-code",children:[(0,a.jsx)("button",{type:"button","aria-label":"Copy button",className:"copy-button",onClick:s=>{(async()=>{s.preventDefault(),await onClick(n)})()},children:(0,a.jsx)(i.Z,{name:c()("fa","fa-2x","fa-clipboard","copy-icon")})}),n]}):n}},7518:function(s,n,e){"use strict";var a=e(5893);e(7294),n.Z=function(s){let{name:n}=s;return(0,a.jsx)("i",{className:n})}},3882:function(s,n,e){"use strict";e.d(n,{Z:function(){return Layouts_Page}});var a=e(5893),l=e(7294),c=e(7931);let i=new Date,r=i.getFullYear();var components_Footer=function(){let s;return(0,a.jsx)("footer",{children:(0,a.jsx)("div",{children:(0,a.jsx)("p",{children:(s=r===c.Z.since?String(c.Z.since):"".concat(c.Z.since,"-").concat(r),"Ⓒ ".concat(s," ").concat(c.Z.fullName))})})})},t=e(9008),h=e.n(t),Head=function(){return(0,a.jsx)(h(),{children:(0,a.jsx)("title",{children:"Kamaal Farah"})})},j=e(1664),d=e.n(j),o=e(3967),p=e.n(o),m=e(7518),components_Divider=function(s){let{className:n}=s,e=p()("divider",null!=n?n:"");return(0,a.jsx)("div",{className:e})},hooks_useMediaQuery=function(s){let[n,e]=l.useState(!1);return l.useEffect(()=>{let a=window.matchMedia(s);function listener(){n!==a.matches&&e(a.matches)}return a.matches!==n&&e(a.matches),window.addEventListener("resize",listener),()=>{window.removeEventListener("resize",listener)}},[n,s]),n};function Header(){let[s,n]=l.useState(!1),e=hooks_useMediaQuery("(max-width: 770px)"),i=l.useCallback(e=>{e.preventDefault(),n(!s)},[s]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"header",children:[(0,a.jsx)("div",{className:"home-link",children:(0,a.jsx)(d(),{href:"/",children:c.Z.fullName})}),(0,a.jsx)("div",{className:"menu-links",children:(0,a.jsx)(Header.MenuItems,{showMobileLayout:e,dropDownMenuItemsAreVisible:s,onHamburgerClick:i})})]}),(0,a.jsx)(Header.Dropdown,{isVisible:s&&e})]})}Header.Dropdown=function(s){let{isVisible:n}=s;return n?(0,a.jsxs)("div",{className:"dropdown-container",children:[(0,a.jsx)(components_Divider,{className:"animated-appearing"}),(0,a.jsx)("ul",{className:p()("dropdown","animated-appearing"),children:c.Z.menuItems.map(s=>{let{id:n,name:e,link:l}=s;return(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:l,children:e})},n)})}),(0,a.jsx)(components_Divider,{className:p()("animated-appearing","no-margin-bottom")})]}):null},Header.MenuItems=function(s){let{showMobileLayout:n,dropDownMenuItemsAreVisible:e,onHamburgerClick:l}=s;return n?(0,a.jsx)("button",{type:"button","aria-label":"Options menu",className:"icon-link",onClick:l,children:(0,a.jsx)(m.Z,{name:p()("fa","fa-bars","fa-fw","hamburger",{toggled:e})})}):(0,a.jsx)(a.Fragment,{children:c.Z.menuItems.map(s=>{let{id:n,name:e,link:l}=s;return(0,a.jsx)(d(),{href:l,children:e},n)})})};var Layouts_Page=function(s){let{children:n,title:e}=s;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Head,{}),(0,a.jsx)(Header,{}),(0,a.jsxs)("main",{children:[null!=e?(0,a.jsx)("h1",{className:"title",children:e}):null,n]}),(0,a.jsx)(components_Footer,{})]})}},7931:function(s,n){"use strict";n.Z={fullName:"Kamaal Farah",menuItems:[{id:"7845be0e-c294-48a4-9515-235d97b9ce83",link:"/projects",name:"Projects"},{id:"2f58ea56-1a22-4641-872f-873efb9b48fc",link:"/til",name:"TIL"}],socials:[{id:"69f7f3ca-72a0-4feb-aa17-27da51e09351",icon:"fa fa-2x fa-github",name:"GitHub",url:"https://github.com/kamaal111/"},{id:"59083d8c-399a-49dd-be52-4e4031a14023",icon:"fa fa-2x fa-linkedin",name:"LinkedIn",url:"https://www.linkedin.com/in/kamaalfarah/"},{id:"62959d55-66a9-4212-8ded-33e817c88c50",icon:"fa fa-2x fa-apple",name:"App Store",url:"https://apps.apple.com/bj/developer/kamaal-farah/id1502158009/"}],since:2020,currentRoles:["Full Stack Software Engineer","iOS/macOS Developer"],contactEmail:"app.kamaal@gmail.com",lastUpdatedTermsAndConditions:"February 14th 2022"}},1151:function(s,n,e){"use strict";e.d(n,{ah:function(){return useMDXComponents}});var a=e(7294);let l=a.createContext({});function useMDXComponents(s){let n=a.useContext(l);return a.useMemo(()=>"function"==typeof s?s(n):{...n,...s},[n,s])}}},function(s){s.O(0,[456,774,888,179],function(){return s(s.s=5479)}),_N_E=s.O()}]);